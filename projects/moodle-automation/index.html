<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Moodle Automation - Aldrin Jenson</title><meta name=description content="CS undergrad from Kerala, India"><link rel=icon type=image/x-icon href=aldrinjenson-github-io.vercel.app/favicon.ico><link rel=apple-touch-icon-precomposed href=aldrinjenson-github-io.vercel.app/favicon.png><link rel=stylesheet href=aldrinjenson-github-io.vercel.app/aldrinjenson-github-io.vercel.app/css/style.min.52d0182c610bf0781cb791431d6abbcbef22b3216890c4a187c7522ae3c71f26.css integrity="sha256-UtAYLGEL8Hgct5FDHWq7y+8isyFokMShh8dSKuPHHyY="><meta property="og:title" content="Moodle Automation"><meta property="og:description" content="NodeJs program to automate the attendance marking in Moodle Classroom "><meta property="og:type" content="article"><meta property="og:url" content="aldrinjenson-github-io.vercel.app/projects/moodle-automation/"><meta property="article:section" content="projects"><meta property="article:published_time" content="2022-01-19T19:25:18+05:30"><meta property="article:modified_time" content="2022-01-19T19:25:18+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Moodle Automation"><meta name=twitter:description content="NodeJs program to automate the attendance marking in Moodle Classroom "><script async src="https://www.googletagmanager.com/gtag/js?id=G-J94XZYNB9C"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J94XZYNB9C",{anonymize_ip:!1})}</script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><h1 class=site-title><a href=aldrinjenson-github-io.vercel.app/>Aldrin Jenson</a></h1><ul class=social-icons><li><a href=https://github.com/aldrinjenson title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://www.linkedin.com/in/aldrinjenson title=Linkedin rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li><li><a href=https://twitter.com/aldrinjenson title=Twitter rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></li><li><a href=https://medium.com/@aldrinjenson title=Medium rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-inline--fa fa-medium" data-icon="medium" data-prefix="fab" focusable="false" role="img" viewBox="0 0 640 512"><path fill="currentcolor" fill="currentcolor" d="M180.5 74.26C80.81 74.26.0 155.6.0 256S80.82 437.7 180.5 437.7 361 356.4 361 256 280.2 74.26 180.5 74.26zm288.3 10.65c-49.85.0-90.25 76.62-90.25 171.1s40.41 171.1 90.25 171.1 90.25-76.62 90.25-171.1H559c0-94.51-40.4-171.1-90.2-171.1zm139.5 17.82c-17.53.0-31.74 68.63-31.74 153.3s14.2 153.3 31.74 153.3S640 340.6 640 256c0-84.6-14.2-153.3-31.7-153.3z"/></svg></span></a></li><li><a href=https://aldrinjenson.github.io/index.xml title=Rss rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-rss" viewBox="0 0 16 16"><path fill="currentcolor" d="M14 1a1 1 0 011 1v12a1 1 0 01-1 1H2a1 1 0 01-1-1V2a1 1 0 011-1h12zM2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2H2z"/><path fill="currentcolor" d="M5.5 12a1.5 1.5.0 11-3 0 1.5 1.5.0 013 0zm-3-8.5a1 1 0 011-1c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 01-1-1zm0 4a1 1 0 011-1 6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 01-1-1z"/></svg></span></a></li></ul></div><nav><a href=aldrinjenson-github-io.vercel.app/ title=Home>Home</a>
<a href=aldrinjenson-github-io.vercel.app/posts/ title=Posts>Posts</a>
<a href=aldrinjenson-github-io.vercel.app/projects/ title=Projects>Projects</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><header class=post-header><h1 class="p-name post-title">Moodle Automation</h1></header><div class="content e-content"><p>Reflections on a nodeJS program I wrote to automate marking online attendance.</p><h2 id=motivation>Motivation</h2><p>I used to attend online classes. Sometimes I&rsquo;ll be sleepy or the class may be really boring, but I always used to attend them given a choice. However, at times I used to forget marking the attendance.</p><p>The attendance marking system in our college(and in many other Govt. colleges) for online classes was kinda ridiculous. We use the awesome <a href=https://moodle.com/lms/>Moodle LMS</a> system for managing online classes.
The students have to go to the Moodle course page every hour and mark the attendance for that particular subject happening at that particular hour. That&rsquo;s right, the students mark their own attendance irrespective of whether they actually attends any classes at allðŸ¤¦. The funniness of this situation becomes even more evident when the student is presented with the following three options for marking attendance in the course page:
Present, Late or Absent.
Seriously.. will any absent or late student actually mark the same given an option?ðŸ¤·</p><p>Anyways.. I used to attend classes, but the attendance marking was very hard for me. I used to occasionally forget and sometimes by the time I&rsquo;d have remembered about marking the attendance, the hour would&rsquo;ve run out and the option would have been gone to mark it for that subject.</p><p>It once reached a dangerous point where I had only 38% of attendance for DS subject in which I had actually missed only 2 classes which I think were due to some genuine reasons. This led me to find a solution which was foolproof.</p><h2 id=thought-process>Thought Process</h2><p>I thought about the flow a student takes to mark his attendance.</p><ul><li>He navigates to the course page</li><li>He logs in to the moodle account by entering email and password. (yeah there are no persistent cookies in Moodle to preserve login state, atleast it&rsquo;s not set up in the Moodle installation our college uses).</li><li>He clicks the attendance anchor tag element to go to the attendance page.</li><li>He selects the list item for the date which is having a field for marking attendance.</li><li>Once clicked he is navigated to another page having the 3 options: Present, Absent, Late</li><li>He selects the radio button for Present(obviously)</li><li>He clicks the Submit button.</li><li>He sighs at having marked his own attendance. The End</li></ul><p>The fact that I could describe the steps this way meant that I could definitely ask a computer to do these for me ie. to automate the process. Now the question was how to implement a program which could log in on my behalf and mark the attendance by following the above steps. Additionally I also wanted a way to let me know once the attendance had been successfully marked or if the attendance marking failed for some reason as then I could go and mark the attendance manually.</p><h2 id=building-the-automation-program>Building the automation program</h2><p>I used the nodeJs <a href=https://github.com/puppeteer/puppeteer/>puppeteer</a> library for browser automation.
I had once used it an year before for generating PDFs out of html.<br>Anyways, I created a new nodeJs project, installed puppeteer and added my username and password as environment variables.<br>I created a file wherein I could add the subjectLinks for which I wanted to automatically mark attendance. I also installed expressJs and created a web UI - something like a dashboard which could show me the stats for various subjects - whether they were marked, when is the next check etc.</p><img src=aldrinjenson-github-io.vercel.app/images/moodle-bot/dashboard.png width=400 alt="Dashboard preview"><br><p>I tested the program a couple of times. Testing was a bit slow because there would be only one slot for me to test in one hour when there is an actual attendance open to automate.</p><p>Afterwards I installed the awesome <a href=https://github.com/yagop/node-telegram-bot-api>node-telegram-bot-api</a> library for getting notifications through Telegram and also added some control commands as well.
Anyways, within a few days, I had ironed out the bugs(most of them that is) and had the code working fine. Now the question was regarding hosting the server.</p><p>Running a web server is costly(atleast for a student that is). The only option I had was to use an AWS ec2 instance. In the initial code I wrote, I used the node-cron library to set a cron job which automatically executes the scraping program every 30 minutes from morning to evening every day and checks if any of my subject links have got an open attendance to mark. This worked fine.. but the problem was that this would mean my server would have to be continuously running to have the program be executed at the right time.
This was not acceptable.</p><p>So I started looking for alternate solutions, and came upon this wonderful <a href=https://cron-job.org/en/>site</a>ðŸ¤©.My new approach didn&rsquo;t have the cron script in my code. I had an API endpoint which will be called by the cron-job site every 30 minutes from morning to evening. I hosted by code in Heroku and gave the api endpoint url to the cron-job site to ping. Heroku has some serious limitations for free apps which prevents them to be up more than 21 days etc. With my new approach however this was not at all a problem as now my server will be active exactly only when the cron site executes ie. it&rsquo;ll be active only when it is time to mark the attendance. No extra wasted awake time.</p><p>I hosted the project, and I have to say by the end of semester I had more than 75% of attendance for all subjects. Mind you that I actually did attend all the online classes myself, just that I didn&rsquo;t have to do the boring process of opening Moodle and marking the attendance manually.</p><img src=aldrinjenson-github-io.vercel.app/images/moodle-bot/bot.png width=400 alt="bot preview"><br><h2 id=afterthoughts>Afterthoughts</h2><p>One doubt I initially had was if this was a good project from an ethical standpoint and whether my code could be used by others for getting attendance without coming to class. Since I was conflicted on this, for over one year, I didn&rsquo;t tell to anyone about this project and kept the code in a private Github repo. However it was only a matter of time before I saw that students were just tired of this stupid process of manually going to moodle and marking their own attendance. I saw over 4 other automation projects for marking attendance, ie students were trying to find a way to get around the broken system;</p><p>Me keeping my project closed because I was afraid of my code being misused didn&rsquo;t really matter much, people were always looking for a workaround and it was only a matter of time before they follow similar paths that you took.</p><p>That being said, each time I saw another attendance automation project, I couldn&rsquo;t just think that my version of automation was actually kinda good. You didn&rsquo;t even have to enter any timetable, just the attendance page urls would suffice. I saw projects for which you have to enter time-tables which was a problem because sometimes time tables may change or a different teacher may take class on a different subject if one teacher is on leave etc. Other automation projects I sad didn&rsquo;t have a notification system as well, they were all python programs written to be run in the terminal. I was kinda happy though that I wasn&rsquo;t the only one fed up of this system, but this also made me wonder if using your skills to get around a broken system is actually wrong..</p><p>I open sourced the project after 14 months of the initial commit. Within that period I have seen good people losing attendance(and hence their marks due to the minimum 75% attendance scheme in Kerala colleges) because they had forgotten to mark in Moodle often times when they had attended the actual classes as well. I open sourced my code without any flashy announcements in the firm belief that if one is genuinely looking for a solution, he should find it. As the Bible says, &ldquo;Seek and You will Find&rdquo;.</p><p>Check out the code <a href=https://github.com/aldrinjenson/moodle-automation>here</a> :).</p></div><div class=post-info><div class="post-date dt-published">19-01-2022</div><a class="post-hidden-url u-url" href=aldrinjenson-github-io.vercel.app/projects/moodle-automation/>aldrinjenson-github-io.vercel.app/projects/moodle-automation/</a>
<a href=aldrinjenson-github-io.vercel.app/ class="p-name p-author post-hidden-author h-card" rel=me>Aldrin Jenson</a><div class=post-taxonomies><ul class=post-tags><li><a href=aldrinjenson-github-io.vercel.app/tags/tech>#tech</a></li><li><a href=aldrinjenson-github-io.vercel.app/tags/telegram>#telegram</a></li><li><a href=aldrinjenson-github-io.vercel.app/tags/nodejs>#nodeJs</a></li></ul></div></div></article><div class="pagination post-pagination"><div class="left pagination-item disabled"></div><div class="right pagination-item"><a href=aldrinjenson-github-io.vercel.app/projects/query-search-bot/>Query Search Bot</a></div></div><script src=https://utteranc.es/client.js repo=aldrinjenson/aldrinjenson.github.io issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>Â© <a href=https://github.com/aldrinjenson/aldrinjenson.github.io target=_blank>Aldrin Jenson </a>, 2023<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a><br></p><br></div><button class=theme-switcher>Dark theme</button>
<script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme"}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}</script></div><p class="h-card vcard"><a href=aldrinjenson-github-io.vercel.app/ class="p-name u-url url fn" rel=me>Aldrin Jenson</a>
/
<a class="p-email u-email email" rel=me href=mailto:aldrinjenson@gmail.com>aldrinjenson@gmail.com</a>
<img class=u-photo src=aldrinjenson-github-io.vercel.app/images/me.jpg></p></footer></div></body></html>