<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Query Search Bot - Aldrin's Blog</title><meta name=description content="CS undergrad from Kerala, India"><link rel=icon type=image/x-icon href=https://aldrinjenson.me/favicon.ico><link rel=apple-touch-icon-precomposed href=https://aldrinjenson.me/favicon.png><link rel=stylesheet href=https://aldrinjenson.me/css/style.min.f4eb13e56aed35bf3e86401b634a04a16d7839a2d3981f5a9529ec32f65da88a.css integrity="sha256-9OsT5WrtNb8+hkAbY0oEoW14OaLTmB9alSnsMvZdqIo="><meta property="og:title" content="Query Search Bot"><meta property="og:description" content="A telegram bot I made to make the internet queries directly from telegram"><meta property="og:type" content="article"><meta property="og:url" content="https://aldrinjenson.me/projects/query-search-bot/"><meta property="article:section" content="projects"><meta property="article:published_time" content="2021-10-24T19:25:18+05:30"><meta property="article:modified_time" content="2021-10-24T19:25:18+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Query Search Bot"><meta name=twitter:description content="A telegram bot I made to make the internet queries directly from telegram"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J94XZYNB9C"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J94XZYNB9C",{anonymize_ip:!1})}</script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><h1 class=site-title><a href=https://aldrinjenson.me/>Aldrin's Blog</a></h1><ul class=social-icons><li><a href=https://github.com/aldrinjenson title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://www.linkedin.com/in/aldrinjenson title=Linkedin rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li><li><a href=https://twitter.com/aldrinjenson title=Twitter rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></li><li><a href=https://medium.com/@aldrinjenson title=Medium rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-inline--fa fa-medium" data-icon="medium" data-prefix="fab" focusable="false" role="img" viewBox="0 0 640 512"><path fill="currentcolor" fill="currentcolor" d="M180.5 74.26C80.81 74.26.0 155.6.0 256S80.82 437.7 180.5 437.7 361 356.4 361 256 280.2 74.26 180.5 74.26zm288.3 10.65c-49.85.0-90.25 76.62-90.25 171.1s40.41 171.1 90.25 171.1 90.25-76.62 90.25-171.1H559c0-94.51-40.4-171.1-90.2-171.1zm139.5 17.82c-17.53.0-31.74 68.63-31.74 153.3s14.2 153.3 31.74 153.3S640 340.6 640 256c0-84.6-14.2-153.3-31.7-153.3z"/></svg></span></a></li><li><a href=https://aldrinjenson.github.io/index.xml title=Rss rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-rss" viewBox="0 0 16 16"><path fill="currentcolor" d="M14 1a1 1 0 011 1v12a1 1 0 01-1 1H2a1 1 0 01-1-1V2a1 1 0 011-1h12zM2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2H2z"/><path fill="currentcolor" d="M5.5 12a1.5 1.5.0 11-3 0 1.5 1.5.0 013 0zm-3-8.5a1 1 0 011-1c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 01-1-1zm0 4a1 1 0 011-1 6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 01-1-1z"/></svg></span></a></li></ul></div><nav><a href=https://aldrinjenson.me/about/ title=About>About</a>
<a href=https://aldrinjenson.me/posts/ title=Posts>Posts</a>
<a href=https://aldrinjenson.me/projects/ title=Projects>Projects</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><header class=post-header><h1 class="p-name post-title">Query Search Bot</h1></header><div class="content e-content"><p>I started my experiments with Telegram Bots in the November of 2020 when I wanted an easy way to receive notifications.
Discord was the first option, but it was just too cumbersome for the simple purpose of receiving notifications. Telegram was much more convenient and easy to use. I used and built various Telegram bots of different complexities during my tenure at TGH Tech. I also used it for my <a href=https://aldrinjenson.me/projects/moodle-automation>Moodle Automation</a> program as well.</p><h2 id=motivation>Motivation</h2><p>This is one of my first major Telegram bot and was first made to get myself familiar with the functions offered by the <a href=https://github.com/yagop/node-telegram-bot-api>node-telegram-bot-api</a> library. The idea is simple - make Internet queries without leaving telegram.</p><h2 id=the-flow>The flow</h2><p>The steps involved are as follows:</p><ul><li>The user adds the bot to a group</li><li>He uses a command to trigger the bot</li><li>He sends the bot a query to search</li><li>The bot sends the top search results of that particular query.</li><li>END</li></ul><h2 id=implementation>Implementation</h2><p>Searching part is basically web-scraping. While google doesn&rsquo;t provide a free api to search, there are some alternative implementation like <a href=https://github.com/jarun/googler>googlr</a>. I tried to use these alternatives, but they either works only in the cli or were just too cumbersome to use.<br>With Google unavailable, I started looking for alternatives, which lead me to my answer -> Bing api. Initially I was a bit skeptical about using bing search engine, but turns out it&rsquo;s the second most popular search engine after Google even though there&rsquo;s a large market share gap.
I found that the results for search queries were quite reasonable as well.<br>So with bing fixed, I used the <a href=https://www.npmjs.com/package/bing-scraper>bing-scraper</a> npm package for my query searching.</p><hr><p>The logic was quite simple actually. Whenever the user sends a search query to the bot, in the backend, the bot uses the above library to scrape bing and find the top results which are then sent as response messages back to the user.</p><p>Since this was a small project, I didn&rsquo;t want to host it on a server as usual. Heroku was the first option I thought about. However, due to Heroku&rsquo;s free tier limitations, once the server entered a sleep state, it needs an external HTTP request to wake it up. The telegram bot I set up was using constant polling mechanism to listen for requests, which meant that the telegram triggers won&rsquo;t wake up the Heroku server.</p><p>I initially tried to create a simple API endpoint from the server, and then constantly pinging it at regular intervals to prevent the server from going to sleep. However even this wasn&rsquo;t sustainable as Heroku free tier has this limitation that your server cannot be active for more than 500 hours per month. Bummer.</p><p>So as usual, I started looking for other options to get free hosting. I had an AWS account. I didn&rsquo;t want to use and ec2 for this small project. But there were <a href=https://aws.amazon.com/lambda>Lambdas</a> available. I didn&rsquo;t have much experiences with serverless computing before, but this seemed like a good opportunity to try them out. AWS Lambda offers 1 million free requests per month, which seemed more than plenty for my use case😇.</p><h2 id=implementing-lambda-functions>Implementing Lambda functions</h2><p>Implementing lambda functions can be made very easy using the <a href=https://www.serverless.com/>serverless framework</a>.
It was very confusing for me initially on the product&rsquo;s name - Serverless, the same name as the serverless architecture. 🤷 I&rsquo;ll refer to the Serverless platform with a capital S.
The process involved the following steps:</p><ul><li>You install Serverless cli and generates the serverless boilerplate for nodeJs(other languages also available)</li><li>You create a Serverless account and login to your dashboard</li><li>You connect your cloud provider(AWS Lambda in my case) to Serverless</li><li>You push your code to a github repo and connect it to the Serverless platform. (optional)</li><li>You enter the command <code>sls deploy</code> in your code directory to deploy the code to the connected cloud provider.</li><li>END</li></ul><p>Now there was one change I had to make for the bot to work with serverless. Since serverless functions will be active only once a request has been received, my initial approach of using long polling(default approach in the node-telegram-bot-api library as well) to query for updates won&rsquo;t work. So I used webhook approach to fix this issue. Basically once the user sends a message to the bot, it reaches the Telegram servers first, and then from there it calls the deployed serverless url wherein I have a switch statement that fires functions depending on the message content/command. <a href=https://github.com/aldrinjenson/tg-querySearchBot/blob/d5260c7672909f07ca664bb075369f4bfbe0b5cd/index.js#L50>Here&rsquo;s</a> the actual code implementation.
Check out the <a href=https://github.com/aldrinjenson/tg-querySearchBot/blob/main/README.md>ReadMe file</a> as well where I&rsquo;ve added some instructions on the process of setting up webhooks for telegram bots.</p><h2 id=conclusion>Conclusion</h2><p>Once the serverless flow was understood, then building and deploying the bot was not that difficult. I had used this same bot as an example to explain the concept of building and deploying bots to many others. Overall even thought the project was kinda small in code or logic, it contained many learnings and people other than me were able to benefit out of this project. So Lesson learned, it&rsquo;s better almost always to learn something by building rather than just by simply watching a Youtube tutorial without applying the concepts.</p><p>This bot was actually the base of many other complex Telegram bots I made. By the end of 2 months in TGH Tech, I was pretty well-versed in the node-telegram-bot-api library and had even written several utility functions to make a lot of tasks much, much easier. It was my wish to group them together and publish them as a library so that many other who faced similar problems could use it. Sadly though, I got busy afterwards with other projects and by the time I was free, I had lost all touch with bots and I had this feeling that even if I had published them as a library, I may not be able to fix any issues people may raise or even test PRs because I won&rsquo;t be working with any Telegram bots at all. Now though, while writing about this, I&rsquo;m having different thoughts.. may be I think even if I won&rsquo;t be feeling any motivation to fix these, the code could be useful to many people and maybe someone could fork it and work on it to improve.. The chances of bugs are pretty low as well, because several bots are running in production level at TGH tech using the utility functions I wrote.. so hmm, let me see, I&rsquo;ll update it here if I&rsquo;m publishing the library🤞.</p><p>Check out the project <a href=https://github.com/aldrinjenson/tg-querySearchBot>here</a>.<br>Live Demo at <a href=https://t.me/querySearchBot>querySearchBot</a>.</p></div><div class=post-info><div class="post-date dt-published">24-10-2021</div><a class="post-hidden-url u-url" href=https://aldrinjenson.me/projects/query-search-bot/>https://aldrinjenson.me/projects/query-search-bot/</a>
<a href=https://aldrinjenson.me/ class="p-name p-author post-hidden-author h-card" rel=me>Aldrin Jenson</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://aldrinjenson.me/tags/tech>#tech</a></li><li><a href=https://aldrinjenson.me/tags/telegram>#telegram</a></li><li><a href=https://aldrinjenson.me/tags/serverless>#serverless</a></li><li><a href=https://aldrinjenson.me/tags/aws>#AWS</a></li></ul></div></div></article><div class="pagination post-pagination"><div class="left pagination-item"><a href=https://aldrinjenson.me/projects/moodle-automation/>Moodle Automation</a></div><div class="right pagination-item"><a href=https://aldrinjenson.me/projects/love-calculator/>Love Match Calculator</a></div></div><script src=https://utteranc.es/client.js repo=aldrinjenson/aldrinjenson.github.io issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© <a href=https://github.com/aldrinjenson/aldrinjenson.github.io target=_blank>Aldrin Jenson </a>, 2022<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br></p></div><button class=theme-switcher>Dark theme</button>
<script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme"}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}</script></div><p class="h-card vcard"><a href=https://aldrinjenson.me/ class="p-name u-url url fn" rel=me>Aldrin Jenson</a>
/
<a class="p-email u-email email" rel=me href=mailto:aldrinjenson@gmail.com>aldrinjenson@gmail.com</a>
<img class=u-photo src=https://aldrinjenson.me/images/me.jpg></p></footer></div></body></html>